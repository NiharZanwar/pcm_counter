<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>display</title>
</head>


<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/display.css') }}">

<body>
<div class="grid-container">
    <div class="banner">
        <marquee id="banner-id"><b>STAY SAFE. WEAR MASK. WASH HANDS. USE SANITIZER</b></marquee>
    </div>
    <div class="advertisement">
        <div id="advertisement-id">
            <img src="get_icon/soc-distance.jpg">
        </div>
    </div>
    <div class="border"></div>
    <div class="status">
        <div class="status-message">
            <div class="status-message-text">
                <div id="status-message-text-id"></div>
            </div>
            <div class="status-message-icon">
                <div id="status-message-icon-id"></div>
            </div>
        </div>
    </div>
    <div class="occupancy">
        <div class="occupancy-data">
            <div class="occupancy-max-text"><b>MAXIMUM OCCUPENCY</b></div>
            <div class="occupancy-max-count">
                <div id="occupency-max-count-id"></div>
            </div>
            <div class="occupancy-current-text"><b>CURRENT OCCUPENCY</b></div>
            <div class="occupency-current-count">
                <div id="occupency-current-count-id"></div>
            </div>
        </div>
    </div>
    <div class="in-out">
        <div class="logo">
            <div class="time"></div>
            <div class="logo-image">
                <div id="logo-image-id"><img src="get_icon/logo.png"></div>

            </div>
        </div>
        <div class="in-out-data">
            <div class="in-count">
                <div id="in-count-id" style="color: #21211d"></div>
            </div>
            <div class="in-text">IN</div>
            <div class="out-count">
                <div id="out-count-id" style="color: #21211d"></div>
            </div>
            <div class="out-text">OUT</div>
            <div class="add-data">INDIA COVID-19 : 23,452</div>
        </div>
    </div>
</div>


<audio id="stop-audio">
    <!--  <source src="horse.ogg" type="audio/ogg">-->
    <source src="/get_icon/STOP.mp3" type="audio/mpeg">
</audio>

<script>

    var current_status =

    timer = setInterval(update_screen, 2000);

    function change_occupancy_color(color, value) {
        document.getElementById("occupency-current-count-id").innerHTML = "<style>#occupency-current-count-id{" +
            "background-color: " + color + "}</style>" + value;
    }

    function change_status_color(color, value) {
        document.getElementById("status-message-text-id").innerHTML = "<style>#status-message-text-id{" +
            "background-color: " + color + "}</style>" + value;
    }

    function change_occupancy_max_count(value) {
        document.getElementById("occupency-max-count-id").innerHTML = value;
    }

    function change_in_out_color(value_in, value_out) {
        document.getElementById("in-count-id").innerHTML = value_in;
        document.getElementById("out-count-id").innerHTML = value_out;
    }

    function change_status_icon(status, color) {
        document.getElementById("status-message-icon-id").innerHTML = "<img src=\"/get_icon/" + status + ".png" + "\" >" +
            "<style>#status-message-icon-id{" +
            "background-color: " + "white" + "}</style>";
    }

    function play_audio(status){
        var myAudio = document.getElementById('stop-audio');

        if (myAudio.duration > 0 && !myAudio.paused) {
            return 0;
            //Its playing...do your job

        } else {
            if(status == "STOP"){
                myAudio.play();
                return 0;
            }
            else{
                return 0;
            }
            //Not playing...maybe paused, stopped or never played.

        }
    }


    function update_screen() {
        var xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                // document.getElementById("data").innerHTML = this.responseText;

                let response = JSON.parse(xhttp.responseText);

                // if(response["current-occupancy"] >= response["maximum_occupancy"]){
                //     change_occupancy_color(response["occupancy_color"])
                // }
                // document.getElementsByClassName("occupancy-current-count").innerHTML = response["current_occupancy"];
                // document.getElementById("occupency-current-count-id").innerHTML = response["current_occupancy"];
                change_occupancy_color(response["occupancy_color"], response["occupancy"]);
                change_status_color(response["occupancy_color"], response["status"]);
                change_occupancy_max_count(response["maximum_occupancy"]);
                change_in_out_color(response["in"], response["out"]);
                change_status_icon(response["status"], response["occupancy_color"]);

                play_audio(response["status"]);
            }
        };

        xhttp.open("GET", "update_screen", true);
        xhttp.send(null);
    }
</script>
</body>
</html>